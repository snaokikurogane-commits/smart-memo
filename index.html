<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AIãƒ¡ãƒ¢</title>
  <style>
    body { font-family: sans-serif; background: #f4f7f6; margin: 0; padding: 15px; color: #333; }
    
    /* å…¥åŠ›ã‚¨ãƒªã‚¢ */
    .input-box { position: relative; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
    textarea { width: 100%; height: 80px; border: none; font-size: 16px; resize: none; outline: none; }
    
    .mic-btn { position: absolute; right: 15px; bottom: 15px; font-size: 24px; background: none; border: none; cursor: pointer; }
    .mic-btn.recording { color: red; animation: pulse 1s infinite; }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }

    .send-btn { width: 100%; background: #333; color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; font-size: 16px; cursor: pointer; margin-top: 10px; }
    .send-btn:disabled { background: #ccc; }

    /* ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ */
    .filter-scroll { overflow-x: auto; white-space: nowrap; margin-bottom: 15px; padding-bottom: 5px; }
    .filter-btn { display: inline-block; padding: 6px 15px; margin-right: 8px; background: #e0e0e0; border-radius: 20px; font-size: 13px; cursor: pointer; }
    .filter-btn.active { background: #007bff; color: white; }

    /* ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆ */
    #memo-list { list-style: none; padding: 0; }
    .memo-card { background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border-left: 5px solid #ccc; }
    
    /* ã‚«ãƒ†ã‚´ãƒªåˆ¥ã®è‰² */
    .cat-ä»•äº‹ { border-left-color: #007bff; }
    .cat-ã‚¢ã‚¤ãƒ‡ã‚¢ { border-left-color: #ffc107; }
    .cat-ToDo { border-left-color: #ff4d4d; }
    .cat-è²·ã„ç‰© { border-left-color: #28a745; }

    .m-header { display: flex; justify-content: space-between; font-size: 12px; color: #888; margin-bottom: 5px; }
    .m-cat { font-weight: bold; color: #555; }
    .m-content { font-size: 15px; line-height: 1.5; white-space: pre-wrap; }
    .m-tags { margin-top: 8px; font-size: 11px; color: #007bff; }

    #loading { text-align: center; color: #999; display: none; }
  </style>
</head>
<body>

  <div class="input-box">
    <textarea id="text-input" placeholder="æ€ã„ã¤ã„ãŸã“ã¨ã‚’è©±ã™ã‹å…¥åŠ›..."></textarea>
    <button class="mic-btn" onclick="toggleVoice()">ğŸ¤</button>
    <button class="send-btn" onclick="sendMemo()">AIã«åˆ†é¡ã•ã›ã¦ä¿å­˜</button>
  </div>

  <div class="filter-scroll">
    <span class="filter-btn active" onclick="filter('ã™ã¹ã¦', this)">ã™ã¹ã¦</span>
    <span class="filter-btn" onclick="filter('ä»•äº‹', this)">ä»•äº‹</span>
    <span class="filter-btn" onclick="filter('ã‚¢ã‚¤ãƒ‡ã‚¢', this)">ã‚¢ã‚¤ãƒ‡ã‚¢</span>
    <span class="filter-btn" onclick="filter('ToDo', this)">ToDo</span>
    <span class="filter-btn" onclick="filter('è²·ã„ç‰©', this)">è²·ã„ç‰©</span>
  </div>

  <div id="loading">èª­ã¿è¾¼ã¿ä¸­...</div>
  <ul id="memo-list"></ul>

  <script>
    // â˜…æ–°ã—ã„GASã®URLã‚’å…¥ã‚Œã‚‹
    const API_URL = "https://script.google.com/macros/s/AKfycbx3A7iiRUXAGMlUjnY8oa8aIVqYQ0HKo8v0nf3IVcF6zaeW04hCqmAQ76d4U71OcqkMlA/exec";
    
    let allMemos = [];

    window.onload = loadMemos;

    async function loadMemos() {
      document.getElementById('loading').style.display = 'block';
      try {
        const res = await fetch(API_URL);
        allMemos = await res.json();
        renderMemos(allMemos);
      } catch(e) { alert("Error"); }
      document.getElementById('loading').style.display = 'none';
    }

    function renderMemos(memos) {
      const list = document.getElementById('memo-list');
      list.innerHTML = "";
      memos.forEach(m => {
        const li = document.createElement('li');
        li.className = `memo-card cat-${m.category}`;
        li.innerHTML = `
          <div class="m-header">
            <span class="m-cat">${m.category}</span>
            <span>${m.date}</span>
          </div>
          <div class="m-content">${m.content}</div>
          <div class="m-tags">#${m.tags.replace(/ /g, ' #')}</div>
        `;
        list.appendChild(li);
      });
    }

    // é€ä¿¡å‡¦ç†
    async function sendMemo() {
      const text = document.getElementById('text-input').value;
      if(!text) return;
      
      const btn = document.querySelector('.send-btn');
      btn.disabled = true;
      btn.innerText = "AIãŒè€ƒãˆä¸­...";

      try {
        await fetch(API_URL, {
          method: "POST",
          body: JSON.stringify({ text: text })
        });
        document.getElementById('text-input').value = "";
        await loadMemos(); // ãƒªã‚¹ãƒˆå†èª­ã¿è¾¼ã¿
      } catch(e) { alert("é€ä¿¡ã‚¨ãƒ©ãƒ¼"); }
      
      btn.disabled = false;
      btn.innerText = "AIã«åˆ†é¡ã•ã›ã¦ä¿å­˜";
    }

    // ãƒ•ã‚£ãƒ«ã‚¿æ©Ÿèƒ½
    function filter(cat, btn) {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      if (cat === 'ã™ã¹ã¦') {
        renderMemos(allMemos);
      } else {
        const filtered = allMemos.filter(m => m.category === cat);
        renderMemos(filtered);
      }
    }

    // éŸ³å£°å…¥åŠ›
    let recognition;
    function toggleVoice() {
      if (!recognition) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) return alert("éå¯¾å¿œã§ã™");
        recognition = new SpeechRecognition();
        recognition.lang = 'ja-JP';
        recognition.onresult = (e) => {
          document.getElementById('text-input').value += e.results[0][0].transcript;
        };
        recognition.onend = () => document.querySelector('.mic-btn').classList.remove('recording');
      }
      
      const btn = document.querySelector('.mic-btn');
      if (btn.classList.contains('recording')) {
        recognition.stop();
      } else {
        recognition.start();
        btn.classList.add('recording');
      }
    }
  </script>
</body>
</html>
